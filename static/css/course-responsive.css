/* ====================================================================
   --- Platform Responsive Stylesheet (Final) ---
   ==================================================================== */

/* --- Tablet & Small Desktops (max-width: 1200px) --- */
@media (max-width: 1200px) {
    .task-review-workspace, .profile-grid {
        grid-template-columns: 1fr;
    }
    .profile-avatar-card {
        max-width: 350px;
        margin: 0 auto;
    }
    .course-wrapper {
        flex-direction: column;
    }
    .lessons-sidebar {
        width: 100%;
        min-width: auto;
        position: static;
    }
    .feedback-panel {
        position: static;
    }
}

/* --- Tablet (max-width: 992px) --- */
@media (max-width: 992px) {
    .sidebar {
        transform: translateX(-100%);
        z-index: 1000;
    }
    .sidebar.is-open {
        transform: translateX(0);
        box-shadow: 10px 0 30px rgba(0,0,0,0.5);
    }
    .main-content {
        margin-left: 0;
    }
    .mobile-menu-toggle {
        display: block;
        z-index: 1001;
    }
    .platform-header {
        padding: 0 20px;
    }
    .header-left h2 {
        display: none;
    }

    .admin-dashboard-grid {
        grid-template-columns: 1fr;
    }

    /* Course Lessons Toggle */
    .lessons-sidebar { padding: 15px; }
    .lessons-toggle-btn {
        display: flex; justify-content: space-between; align-items: center;
        width: 100%; background: none; border: none;
        color: var(--text-light); text-align: left;
        padding: 10px; cursor: pointer;
        border-radius: var(--border-radius-small);
        transition: background-color var(--transition-fast);
    }
    .lessons-toggle-btn:hover { background-color: var(--bg-surface-light); }
    .lessons-toggle-btn h3 { margin-bottom: 0; }
    .lessons-toggle-btn i { font-size: 1.2rem; transition: transform 0.4s ease; }
    .lessons-toggle-btn.is-open i { transform: rotate(180deg); }
    .lessons-list { max-height: 0; overflow: hidden; transition: max-height 0.4s ease; padding-top: 0; }
    .lessons-list.is-open { max-height: 1000px; padding-top: 10px; }

    .students-list-view .list-header { display: none; }
    .students-list-view .list-item {
        grid-template-columns: 2fr auto;
        padding: 20px;
    }
    .students-list-view .list-item > .student-progress,
    .students-list-view .list-item > div:nth-of-type(3),
    .students-list-view .list-item > div:nth-of-type(4) {
        display: none;
    }
}

/* --- Mobile (max-width: 768px) --- */
@media (max-width: 768px) {
    /* FIX 1: Убираем отступы у основного контейнера страницы, чтобы чат мог занять всё место */
    .page-content {
        padding: 0;
    }
    .page-title { font-size: 1.8rem; }
    .form-grid, .review-grid, .applications-grid, .students-grid {
        grid-template-columns: 1fr;
    }

    .user-profile .user-info { display: none; }
    .platform-header { gap: 15px; }
    .header-right { gap: 20px; }

    /* FIX 2: Заставляем контейнер чата занимать всю высоту экрана под шапкой */
    .chat-container {
        height: calc(100vh - var(--header-height));
        border: none;
        border-radius: 0;
    }
    .chat-messages { padding: 15px; }
    .message { max-width: 85%; }
    .chat-input-area { padding: 10px; }
    .chat-form { gap: 10px; }

    /* FIX 3: Увеличиваем шрифт в поле ввода, чтобы предотвратить авто-зум на iOS */
    .chat-form textarea {
        font-size: 16px;
    }

    .feedback-panel .btn-group { flex-direction: column; }
    .task-review-header { flex-direction: column; align-items: flex-start; gap: 15px; }
    .list-controls { flex-direction: column; align-items: stretch; }

    /* FIX: Prevents text from overflowing and causing horizontal scroll */
    .user-list-item .user-info p {
        white-space: normal; /* Allow text to wrap */
        overflow: visible;
        text-overflow: unset;
    }

    /* FIX: Makes filter tabs scroll horizontally if they don't fit */
    .filter-tabs {
        overflow-x: auto;
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    .filter-tabs::-webkit-scrollbar {
        display: none;
    }
    .filter-tab {
        flex-shrink: 0; /* Prevent tabs from shrinking */
    }
}

/* --- Small Mobile (max-width: 480px) --- */
@media (max-width: 480px) {
    /* Восстанавливаем отступ для всех страниц, кроме чата */
    .page-content:not(:has(.chat-container)) {
        padding: 15px;
    }
    .card { padding: 20px; }
    .chat-messages { padding: 10px; }
}
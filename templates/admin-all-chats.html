{% extends 'base-admin.html' %}
{% load static %}

{% block title %}Усі чати - {{ block.super }}{% endblock %}
{% block header_title %}Усі чати{% endblock %}

{% block styles %}
  {{ block.super }}
  <style>
    /* УЛУЧШЕНИЕ: Добавлен эффект при наведении для интерактивности */
    .chat-list .list-item:hover {
        background-color: var(--bg-surface-light);
        transform: translateX(5px);
    }

    .chat-list .list-item {
        align-items: center;
        transition: all 0.2s ease-out; /* Плавный переход для hover-эффекта */
    }

    .chat-list .item-info {
        flex-grow: 1;
        min-width: 0;
    }

    .chat-list .item-info p {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: var(--text-medium);
        font-size: 0.9rem;
        margin: 0;
    }

    .chat-list .chat-meta-info {
        margin-left: 15px; /* Добавлен небольшой отступ */
        flex-shrink: 0;
    }

    /* Исправление для мобильных устройств */
    @media (max-width: 768px) {
        .chat-list .list-item {
            flex-direction: row !important;
            align-items: center !important;
        }
    }

    /* УЛУЧШЕНИЕ: Для очень маленьких экранов скрываем превью сообщения, чтобы не ломать верстку */
    @media (max-width: 420px) {
        .chat-list .item-info p {
            display: none;
        }
        .chat-list .list-item {
            gap: 10px;
        }
    }
  </style>
{% endblock %}


{% block content %}
  <div class="card">
    <form method="GET" action="{% url 'admin_all_chats' %}" class="list-controls">
      <div class="search-bar">
        <i class="fas fa-search"></i>
        <input type="text" name="q" placeholder="Пошук..." value="{{ request.GET.q }}">
      </div>
      <button type="submit" class="btn btn-secondary btn-apply-filters">
        <i class="fas fa-check"></i> Застосувати
      </button>
    </form>

    <div class="admin-modern-list chat-list">
      {% for chat in chats %}
        <a href="{% url 'admin_chat' chat.pk %}" class="list-item">
          <img class="avatar" src="{{ chat.user.avatar.url }}" alt="Avatar">
          <div class="item-info">
            <strong>{{ chat.user.get_full_name }}</strong>
            <p>{{ chat.last_message|default:"Повідомлень ще немає" }}......</p>
          </div>
          <div class="chat-meta-info">
            {% if chat.message_count > 0 %}
              <span class="notification-badge">{{ chat.message_count }}</span>
            {% endif %}
            <span class="date">
              {% if chat.last_message_date %}
                {{ chat.last_message_date|date:"d-m-y, H:i" }}
              {% endif %}
            </span>
          </div>
        </a>
      {% empty %}
        <div style="text-align: center; padding: 30px; color: var(--text-medium);">
          <p>Чати не знайдено.</p>
        </div>
      {% endfor %}
    </div>
  </div>
{% endblock %}
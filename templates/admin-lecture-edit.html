{% extends 'base-admin.html' %}
{% load static %}

{% block title %}Редагування лекції - {{ block.super }}{% endblock %}
{% block header_title %}Редагування лекції{% endblock %}

{% block content %}
  <div class="card">
    <a href="{% url 'admin_lecture_list' %}" class="back-link"><i class="fas fa-arrow-left"></i> До списку лекцій</a>

    <form id="edit-lecture-form" style="margin-top: 20px;">
      <input type="hidden" id="lecture-id" value="1">

      <h4 style="margin-bottom: 20px; color: var(--primary-orange);">Основна частина</h4>
      <div class="form-grid">
        <div class="input-group">
          <label for="lecture-title">Назва лекції</label>
          <input type="text" id="lecture-title" name="lecture-title" required>
        </div>

        <div class="input-group">
          <label for="lecture-video-url">Посилання на відео уроку</label>
          <input type="url" id="lecture-video-url" name="lecture-video-url" required>
        </div>
      </div>

      <div class="input-group" style="margin-top: 10px; margin-bottom: 30px;">
        <label>Зміст лекції</label>
        <div class="quill-editor-wrapper">
          <div id="editor-container"></div>
        </div>
      </div>

      <h4 style="margin-bottom: 20px; color: var(--primary-orange); border-top: 1px solid var(--border-color); padding-top: 30px;">
        <i class="fas fa-tasks"></i> Завдання до уроку
      </h4>
      <div class="input-group">
        <label for="homework-description">Опис домашнього завдання</label>
        <textarea id="homework-description" name="homework-description" rows="5"></textarea>
      </div>

      <div class="btn-group" style="margin-top: 30px; display: flex; gap: 15px;">
        <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Зберегти зміни</button>
        <a href="{% url 'admin_lecture_list' %}" class="btn btn-secondary">Скасувати</a>
      </div>
    </form>
  </div>
{% endblock %}

{% block scripts %}
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

  <script>
      document.addEventListener('DOMContentLoaded', function () {
          const quill = new Quill('#editor-container', {
              theme: 'snow',
              // --- ИСПРАВЛЕННАЯ ПОЛНАЯ ПАНЕЛЬ ИНСТРУМЕНТОВ ---
              modules: {
                  toolbar: [
                      [{'header': [1, 2, 3, false]}],
                      ['bold', 'italic', 'underline', 'link'],
                      [{'list': 'ordered'}, {'list': 'bullet'}],
                      ['image'],
                      ['clean']
                  ]
              },
              placeholder: 'Редагуйте текст лекції тут...'
          });

          quill.getModule('toolbar').addHandler('image', () => { /* ... логика загрузки фото ... */
          });

          // --- Имитация загрузки данных с бэкенда ---
          const lectureId = document.getElementById('lecture-id').value;
          const lectureTitleInput = document.getElementById('lecture-title');
          const videoUrlInput = document.getElementById('lecture-video-url');
          const homeworkInput = document.getElementById('homework-description');

          const existingData = {
              title: 'Урок 4: Закрас та тіні',
              videoUrl: 'https://www.youtube.com/watch?v=example123',
              content: '<p>Це <strong>існуючий</strong> текст лекції...</p>',
              homework: 'Використовуючи тренувальний фрагмент шкіри №4...'
          };

          lectureTitleInput.value = existingData.title;
          videoUrlInput.value = existingData.videoUrl;
          quill.root.innerHTML = existingData.content;
          homeworkInput.value = existingData.homework;

          document.getElementById('edit-lecture-form').addEventListener('submit', function (event) {
              event.preventDefault();
              const title = lectureTitleInput.value;
              const videoUrl = videoUrlInput.value;
              const lectureContent = quill.root.innerHTML;
              const homework = homeworkInput.value;

              console.log({title, videoUrl, lectureContent, homework});
              alert(`Лекцію з ID ${lectureId} оновлено (імітація).`);
              window.location.href = "{% url 'admin_lecture_list' %}";
          });
      });
  </script>
{% endblock %}
{% extends 'admin_templates/../base-admin.html' %}
{% load static %}

{% block title %}–î–∞—à–±–æ—Ä–¥ –ú–µ–Ω—Ç–æ—Ä–∞ - {{ block.super }}{% endblock %}
{% block header_title %}–î–∞—à–±–æ—Ä–¥ –ú–µ–Ω—Ç–æ—Ä–∞{% endblock %}

{% block content %}
  <div class="admin-dashboard-grid">
    <div class="admin-card">
      <div class="admin-card-header">
        <i class="fas fa-inbox"></i>
        <h3>–ó–∞–≤–¥–∞–Ω–Ω—è –Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É ({{ count_of_waiting }})</h3>
      </div>
      <div class="admin-list">
        {% if waiting_for_check %}
          {% for homework in waiting_for_check %}
            <div class="list-item">
              <img class="avatar" src="{{ homework.user.avatar.url }}" alt="Avatar">
              <div class="item-info">
                <strong>{{ homework.user.get_full_name }}</strong>
                <p>–£—Ä–æ–∫ {{ homework.lecture.position_number }}: {{ homework.lecture.lecture_name }}</p>
              </div>
              <a href="{% url 'admin_review_task' homework.pk %}" class="btn btn-sm">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</a>
            </div>
          {% endfor %}
        {% else %}
          <div class="list-item">
            <div class="item-info">
              <p><strong>–ù–∞—Ä–∞–∑—ñ –Ω–µ–º–∞—î –¥–∑ –Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É...</strong></p>
            </div>
          </div>
        {% endif %}
      </div>
    </div>

    <div class="admin-card">
      <div class="admin-card-header">
        <i class="fas fa-chart-line"></i>
        <h3>–ü—Ä–æ–≥—Ä–µ—Å —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ (–æ—Å—Ç–∞–Ω–Ω—ñ–π —ñ –ø–µ—Ä—à–∏–π)</h3>
      </div>
      <div class="admin-list">
        {% if min_progress %}
          <div class="list-item">
            <div class="item-info" style="width: 100%;">
              <strong>{{ min_progress.get_full_name }} -------> {{ min_progress.progress|default:0 }}%üìâ</strong>
              <div class="progress-bar-bg">
                <div class="progress-bar-fill error" style="width: {{ min_progress.progress|default:0 }}%;"></div>
              </div>
            </div>
          </div>
        {% endif %}

        {% if max_progress and max_progress != min_progress %}
          <div class="list-item">
            <div class="item-info" style="width: 100%;">
              <strong>{{ max_progress.get_full_name }} -------> {{ max_progress.progress|default:0 }}%üèÜ</strong>
              <div class="progress-bar-bg">
                <div class="progress-bar-fill success" style="width: {{ max_progress.progress|default:0 }}%;"></div>
              </div>
            </div>
          </div>
        {% endif %}
        {% if not max_progress and not min_progress %}
          <div class="list-item">
            <div class="item-info" style="width: 100%;">
              <strong>–ù–µ–º–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤....</strong>
            </div>
          </div>
        {% endif %}
      </div>
    </div>

    <div class="admin-card full-width">
      <div class="admin-card-header">
        <i class="fas fa-comments"></i>
        <h3>–û—Å—Ç–∞–Ω–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</h3>
      </div>
      <div class="admin-list">
        {% if last_messages %}
          {% for msg in last_messages %}
            <div class="list-item">
              <img class="avatar" src="{{ msg.user.avatar.url }}" alt="Avatar">
              <div class="item-info">
                <strong>{{ msg.user.get_full_name }}</strong>
                <p>"{{ msg.text|truncatewords:3 }}..."</p>
              </div>
              <a href="{% url 'admin_chat' msg.chat_id %}" class="btn btn-sm">–î–æ —á–∞—Ç—É</a>
            </div>
          {% endfor %}
        {% else %}
          <div class="list-item">
            <div class="item-info">
              <p><strong>–ü–æ–∫–∏ —â–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –Ω–µ–º–∞—î...</strong></p>
            </div>

          </div>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}
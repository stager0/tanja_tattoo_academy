{% extends "base.html" %}

{% load static %}

{% block title %}Чат з ментором - {{ block.super }}{% endblock %}
{% block header_title %}Чат з ментором{% endblock %}

{% block content %}
  <div class="chat-container">
    <div class="chat-messages">
      {% if messages %}
        {% for msg in messages %}
          {% if msg.user in admin_ids %}
            <div class="message received">
              <img src="{{ interlocutor_avatar }}" alt="Mentor Avatar" class="message-avatar">
              <div class="message-bubble">
                <p>{{ msg.text }}</p>
                {% if msg.image %}
                  <div class="message-attachment">
                    <img src="{{ msg.image.url }}" alt="Homework Image">
                  </div>
                {% endif %}
                <div class="message-time">{{ msg.send_time }}</div>
              </div>
            </div>
          {% elif msg.user not in admin_ids %}
            <div class="message sent">
              <img src="{{ user.avatar.url }}"
                   alt="User Avatar"
                   class="message-avatar">
              <div class="message-bubble">
                <p>{{ msg.text }}</p>
                {% if msg.image %}
                  <div class="message-attachment">
                    <img src="{{ msg.image.url }}" alt="Homework Image">
                  </div>
                {% endif %}
                <div class="message-time">{{ msg.send_time }}</div>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      {% endif %}
    </div>

    <div class="chat-input-area">
      <div id="upload-preview-container"></div>
      <form class="chat-form" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <label for="file-upload-input" class="btn-icon" aria-label="Прикріпити фото">
            <i class="fas fa-paperclip"></i>
        </label>
        <input type="file" id="file-upload-input" name="image" accept="image/*" style="display: none;">
        <textarea class="autoresize-textarea" name="text" placeholder="Напишіть повідомлення..." rows="1"></textarea>
        <button type="submit" class="btn-icon send-btn" aria-label="Надіслати">
          <i class="fas fa-paper-plane"></i>
        </button>
      </form>
    </div>
  </div>

  <div id="imageModal" class="image-modal">
    <span class="modal-close-btn">&times;</span>
    <img class="modal-content" id="modalImage">
  </div>
{% endblock %}
{% block scripts %}
{{ block.super }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const chatMessages = document.querySelector('.chat-messages');

        if (chatMessages) {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    });
</script>
{% endblock %}